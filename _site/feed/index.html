<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
        xmlns:content="http://purl.org/rss/1.0/modules/content/"
        xmlns:atom="http://www.w3.org/2005/Atom"
  >
  <channel>
    <title>谢益辉</title>
    <atom:link href="http://yihui.name/cn/feed/" rel="self" type="application/rss+xml" />
    <link>http://yihui.name</link>
    <lastBuildDate>2013-05-14T10:03:59+08:00</lastBuildDate>
    <webMaster>xie@yihui.name</webMaster>
    
    <item>
      <title>R的若干基因及争论</title>
      <link>http://yihui.name/cn/2012/09/equal-and-arrow/</link>
      <pubDate>2012-09-18T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/09/equal-and-arrow</guid>
      <content:encoded><![CDATA[<p>R是一门古怪的语言，这一点没什么好否认的。它的古怪有好有坏，在不同人眼中也可能是好事或坏事。R是受S语言影响发展起来的，S语言诞生于贝尔实验室。后来AT&amp;T被分拆的时候，这个实验室被拆为今天的贝尔实验室（已经没什么名气了）和AT&amp;T实验室。如<a href="/cn/2012/08/quo-vadis/">前文</a>所说，这个夏天在AT&amp;T实验室呆着，S语言的一位作者Rick是我的办公室邻居，另一位作者Allan暑假里退休了，第三位作者是John Chambers，他早已离开实验室去高校了。S诞生在（文本）数据堆里，而R诞生之后很快走向了合作开发，这一系列历史给它带来了一些看似古怪的特征。</p>

<h2>赋值</h2>

<p>赋值符号在绝大多数语言中都没什么好讨论的，因为就是一个等号而已。在R社区，这一点却被讨论来讨论去，主要原因是箭头赋值符号<code>&lt;-</code>的存在。箭头<a href="http://developer.r-project.org/equalAssign.html">来源于</a>贝尔实验室早年的某台古董机器上有一个下划线的键，但打出来显示的是箭头。S祖先们认为箭头是一个很形象的赋值符号，于是下划线被采纳下来，甚至后来衍生出右箭头（<code>-&gt;</code>）这样更奇怪的赋值符号（表示把左边的值赋给右边的变量），还有双箭头（<code>&lt;&lt;-</code>）表示给上一层环境中的变量赋值。</p>

<p>最初S代码中，下划线本身就是赋值符号，例如<code>x_1</code>表示把1赋值给x。我大三的时候还用S-Plus写了不少下划线赋值的S代码。后来R core们做了一个艰难的决定，允许等号作为赋值符号，废弃了下划线的赋值功能，但下划线的传统仍然无处不在，例如Emacs / ESS中默认情况下敲下划线会被替代为左箭头（为了得到真的下划线需要连续按两次下划线），尽管下划线本身已经不能直接显示为箭头，ESS仍然想昨日重现，通过软件方式强行替代之。</p>

<p>我不止一次地说过，我是坚定的等号党。因为等号有赋值功能，大多数语言都用等号（没见其它语言的程序员抱怨等号不形象），等号对我来说不存在歧义，让我的代码更安全。反对党（也就是箭头党）的理由通常是等号存在二义性：它既可以赋值，也可以传递函数参数，如：</p>

<div class="highlight"><pre><code class="r">x <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span>
length<span class="p">(</span>x <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span>
</code></pre></div>


<p>可是几乎所有语言都这样，也没有见那些语言的程序员对此有抱怨。规则很简单：如果等号出现在单独的环境中，它就是赋值；如果写在函数参数位置，它就是传参数。但R的古怪让这个简单规则也可以变得很难判断，例如：</p>

<div class="highlight"><pre><code class="r">length<span class="p">((</span>x <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">))</span>
length<span class="p">({</span>x <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">})</span>
</code></pre></div>


<p>因为<code>()</code>和<code>{}</code>将表达式与外面的环境隔离开来，它们被解析的时候先单独运行，所以实际上x在自己的环境里被赋值了；然后<code>()</code>和<code>{}</code>会返回整个表达式的结果，这个结果再传给<code>length()</code>函数。</p>

<p>箭头在任何地方的意思都是赋值（在当前环境下），它可以被写在任何地方，包括函数参数的位置，如：</p>

<div class="highlight"><pre><code class="r">length<span class="p">(</span>x <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span>
</code></pre></div>


<p>这句代码先对x赋值，然后把整个表达式的值传递给<code>length()</code>。我们可以把它写得更晕：</p>

<div class="highlight"><pre><code class="r">length<span class="p">(</span>x <span class="o">=</span> y <span class="o">&lt;-</span> <span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span>
</code></pre></div>


<p>此时等号表示传参数，而y无论如何都会被赋值。在函数参数位置上赋值通常有一举两得的效果，也就是把两件事情写在一行上，之所以能一举两得，主要是利用了箭头的副作用；如果是初学者，这种写法最好避免，首先追求代码的清晰性，避免产生副作用的代码。因为箭头无论何地都可以赋值，要是用错了也不会报错，这种错误往往难以意识到。例如我们创建一个向量，元素为1和2，元素名字分别为a和b，如果不小心写成这样：</p>

<div class="highlight"><pre><code class="r">c<span class="p">(</span>a <span class="o">=</span> <span class="m">1</span><span class="p">,</span> b <span class="o">&lt;-</span> <span class="m">2</span><span class="p">)</span>  <span class="c1"># 本来应该是c(a = 1, b = 2)</span>
</code></pre></div>


<p>你可能不会意识到第二个元素是没有名字的，并且这句话带来一个副作用，就是悄悄给b赋了值。</p>

<p>如果你像我一样有时候写代码不爱打空格，那么还有一个更可怕的潜在错误，要是不小心犯了的话可能很久都查不出来。我们写几个逻辑表达式：x大于5，x小于3，x小于-3。你可能想，这个太简单了，操起键盘就写：</p>

<div class="highlight"><pre><code class="r">x<span class="o">&gt;</span><span class="m">5</span>
x<span class="o">&lt;</span><span class="m">3</span>
x<span class="o">&lt;-</span><span class="m">3</span>
</code></pre></div>


<p>因为你的懒惰，小于号和负号悄磨叽走到了一起，不小心形成了具有强大法力的赋值箭头，你并没有完成x与-3的逻辑大小比较，而是给x赋值为3。当这几行代码在这里摆着的时候你可能觉得很容易看出来，可是当你玩了两个小时数据之后，想随手看一下df数据框中x变量小于-1的值有多少个，你可能会写出<code>sum(df$x&lt;-1)</code>这样的语句，相应的结果是，你没得到<code>df$x</code>小于-1的总数，而是把df数据里x这一列给修改为1了。如果df是一个很大的数据，或你辛辛苦苦处理了半天才得来的数据，你就哭吧。我对这个诡异的案例印象深刻，是因为我亲眼看见过两例别人的错误，在那之后我明知有这样的危险，但自己还是傻不愣登毁了一次自己的数据。</p>

<p>对右箭头赋值，我的想象是这样：某天某祖先写了一长段代码，但没有事先写上把这段代码的结果赋值保留下来，悔得肠子都青了，只好敲回车任凭程序在那儿跑，跑完了得不到返回值，于是该祖先发明了一个右箭头，这样即使先写了一段代码也不用怕，因为可以最后加上<code>-&gt; x</code>就把前面的返回值赋给x了。我不习惯阅读这种事后赋值的代码，就像读侦探小说似的，到最后才发现代码创建了一个变量。</p>

<p>这种“后悔”的想象还可以继续：R中有一个特殊的变量叫<code>.Last.value</code>，它总是保存最近一次运行的最后一个结果，即使你上一条代码没有赋值保存，你仍然可以通过<code>.Last.value</code>去获取。这也意味着，无论你跑什么程序，R都会随时盯着你的返回结果，把它赋值给<code>.Last.value</code>。</p>

<h2>命名风格</h2>

<p>R core的主要命名风格是以点分隔词，例如<code>t.test</code>，这与早年时下划线有赋值含义有关，另外我猜想也是懒惰，因为点只需要按键一次，而其它命名法都需要按Shift键，如camelCase。不过这个也不绝对，R里面仍然有些下划线命名的函数如<code>seq_along</code>，或驼峰命名如<code>summaryRprof</code>。这里面有多人合作时的个人风格，更重要的可能是S3泛型函数的影响。S3函数的特点就是“主函数.类名”，如<code>summary.lm</code>，它根据传递进来的对象的类来匹配具体的子函数。因为在泛型函数中，点是有特殊意义的，所以我们要小心点（这里注意断句），为了安全起见，最好干脆避免点，免得跟泛型函数扯上关系，尤其是包的作者在写函数时。</p>

<p>在其它很多语言如JavaScript中，点通常表示取一个对象的子元素或者应用方法，如<code>x.toString()</code>。R的点不存在这个问题（要达到同样的效果，一般用<code>$</code>），它除了可能有S3的意思，没有其它特殊含义。考虑到其它语言以及S3两个原因，我最终投奔了下划线命名法（<code>foo_bar</code>），次要原因是我觉得下划线把两个单词分得更开，比<code>fooBar</code>易读。</p>

<p>考虑R中有成千上万的函数命名，某些对象命名可以理解，但仍然透露出某种不规范的痕迹。比如<code>seq()</code>是S3泛型函数，而同时又存在<code>seq.int</code>和<code>seq_along</code>这两种风格的函数，并且前者并不是<code>seq()</code>应用在<code>int</code>类上的函数！</p>

<p>每一门语言都有一些历史糟粕，R作为一群统计学家维护的语言，从规范来说槽点很多，但事情的另一面是，他可以让什么最小惊讶原则见鬼去，老夫今天就是要写一个函数把混合效应模型中的随机效应算完打印出来。他的随意对应用统计者来说，可能恰好也是好事。没有这看似乱糟糟的各种贡献，R的发展也许会慢很多。无论如何，对如今已经趋于成熟的R，我们作为用户还是应该尽量朝规范的方向走。</p>

<h2>语法</h2>

<p>以for循环为例，很多语言都是教条式的<code>for (i=0; i&lt;10; i++)</code>循环，而R是<code>for (i in x)</code>，这个x可以是很多种对象，例如<code>1:10</code>，或<code>10:1</code>，或<code>c('a', 'c', 'b')</code>，或<code>list(a = 1, b = 'fgh')</code>，等等。这种让循环变量在一组对象中循环的做法，我猜想可能借鉴自bash脚本的语法，如</p>

<div class="highlight"><pre><code class="bash"><span class="k">for </span>i in <span class="sb">`</span>ls *.csv<span class="sb">`</span>
<span class="k">do</span>
<span class="k">  </span><span class="nb">echo</span> <span class="nv">$i</span>
<span class="k">done</span>
</code></pre></div>


<p>它为啥要参照bash脚本的循环语法而不是C语言的语法，可能跟贝尔实验室的数据处理传统有关。至今AT&amp;T实验室仍然跑着大量的bash脚本，处理大量的文本数据（循环逐个处理每个文件），这一点我在那里感触太深了。同样诞生于贝尔实验室的Awk，其循环语法也借鉴了bash的语法（C语法也保留着），可以在一个数组中循环。</p>

<h2>自动扩展和匹配</h2>

<p>别的语言一般都不能计算猫加狗这样的表达式，但R可以算<code>1:10 + 1:2</code>，两个长度不一样的对象也可以做计算，原因是R总是把短对象自动扩展到长对象的长度再计算；这种扩展有时候很难想象，如<code>matrix(1:10, 5) + 1:2</code>（一个矩阵加一个向量）。向量一般来说看作列向量，也就是n x 1的矩阵，但你可以看见以下表达式都可以正常计算：</p>

<div class="highlight"><pre><code class="r">matrix<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">5</span><span class="p">)</span> <span class="o">%*%</span> <span class="m">1</span><span class="o">:</span><span class="m">2</span>  <span class="c1"># 5x2乘以2x1，没问题</span>
<span class="m">1</span><span class="o">:</span><span class="m">2</span> <span class="o">%*%</span> matrix<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>  <span class="c1"># 2x1乘以1x10，没问题</span>
<span class="m">1</span><span class="o">:</span><span class="m">2</span> <span class="o">%*%</span> matrix<span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>  <span class="c1"># 你到底是2x1还是1x2？</span>
</code></pre></div>


<p>这实在让人防不胜防。除非你事先小心实验，否则这种矩阵乘法出错了都不知道。但这问题其实也来源于作者的懒惰，只要把向量转化为严格的矩阵（不要让R去自动猜测调整），一切问题都解决了。</p>

<p>这些“自动”特征给数据分析其实带来了不少好处，例如在回归设计阵中加一列给截距项的1，你不必写一串1，只要<code>X = cbind(X, 1)</code>就可以了，R会自动把1扩展为X的行数；又如你想让散点图中的点按照数据顺序依次用红色、蓝色、红色、蓝色……那么<code>plot(x, y, col = c('red', 'blue'))</code>就够了，而不必把颜色向量写完整了。对数据分析者来说，那些计算机的严格规则最好是匿得越远越好。</p>

<p>有时候自动扩展悄无声息带来的问题会很难查找，例如在各种巧合之下，kuanguang坛霸<a href="http://cos.name/cn/topic/108092">问的这个问题</a>下面掩盖了一个极大的阴谋，初学者可能看不出里面的门道，楼主的代码运行表面上看起来成功了，但实际上完全是错误的代码。本来这是个很好的例子，只是这家伙碎碎念实在太多了，一天到晚问题不断，我也来一次小心眼，装没看见好了。</p>

<h2>引号</h2>

<p>R的懒惰是别的语言打死都想不通的，比如把一个不存在的对象转化为字符，这么说有点抽象，我们可以考虑一下<code>library()</code>这个函数。</p>

<div class="highlight"><pre><code class="r">library<span class="p">(</span>fun<span class="p">)</span>
</code></pre></div>


<p>这样一句话是什么意思呢？<code>fun</code>不是一个R对象，它根本不存在，但为什么<code>library(fun)</code>就可以加载一个名叫<code>fun</code>的包？主要原因就是懒，因为懒得打引号：</p>

<div class="highlight"><pre><code class="r">library<span class="p">(</span><span class="s">&quot;fun&quot;</span><span class="p">)</span>
</code></pre></div>


<p>正常来说，这个函数的第一个参数应该是R包的名字，也就是说应该是字符串。在函数内部，最终需要的也是一个字符串。R之所以能把这件事情搞得这么奇葩，也是与它强大的“基于语言的计算”（Computing on the Language）能力有关，参见手册“R Language Definition”第6节。所谓基于语言的计算，就是把代码拿来作计算，各种魔法<code>parse()</code>、<code>deparse()</code>、<code>substitute()</code>、<code>eval()</code>、<code>match.call()</code>等等，极大增强了R的语言功能，所以说它是一门统计计算语言实在太低估了它。</p>

<p>例如这里是一个简单的函数，把输入的合法的R符号转化为字符串：</p>

<div class="highlight"><pre><code class="r">f <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> deparse<span class="p">(</span>substitute<span class="p">(</span>x<span class="p">))</span>
f<span class="p">(</span>asdf<span class="p">)</span>
f<span class="p">(</span>hahaha<span class="p">)</span>
</code></pre></div>


<p>这种懒惰在一些Linux工具中也可以看见身影，例如<code>tar</code>，我们可以按标准写上减号<code>-</code>以传参数，也可以省略减号让<code>tar</code>把第一个参数当作参数，后面的参数当文件名：</p>

<div class="highlight"><pre><code class="bash">tar -x -z -f R-2.15.1.tar.gz
tar -xzf R-2.15.1.tar.gz
tar xzf R-2.15.1.tar.gz
</code></pre></div>


<p>这就是“多打一个字符会死星人”。</p>

<p>岔开话题回到<code>library()</code>这个函数，我印象中R core一直后悔这个函数的命名，想把它改成<code>use()</code>。因为<code>library()</code>的存在且高频使用，让很多用户称R包为library（例如I'm using the rpart library），这曾经让某R core（M.M.）极度不爽，因为library在R中的概念是“库”，而不是单个的包，一个库可能是多个包的集合，单个包叫package。啥时侯你意识到函数命名可能比写函数本身还难时，就表明你的码农功力又上一层楼了。</p>

<h2>LaTeX</h2>

<p>那个年代科学计算类都和LaTeX能扯上关系，这年头都奔HTML去了，谁还去打印大部头的手册啊。R的文档就是一种伪LaTeX文档，R自身也拼命模仿一些LaTeX程序，例如<code>texi2dvi()</code>函数。这种伪TeX文档带来的就是新的解析工作，参见<code>parse_Rd()</code>魔法，于是各种规矩铺天盖地而来……</p>

<h2>值传递与引用传递</h2>

<p>R一向没有引用传递，但这说法不太严格，我们可以把一个环境当作参数传递来去，环境里的对象可以在任何地方被改变。</p>

<div class="highlight"><pre><code class="r">z <span class="o">=</span> new.env<span class="p">()</span>
z<span class="o">$</span>x <span class="o">=</span> <span class="m">1</span>
f <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>env<span class="p">)</span> <span class="p">{</span>
  env<span class="o">$</span>x <span class="o">=</span> <span class="m">2</span>
<span class="p">}</span>
f<span class="p">(</span>z<span class="p">)</span>
z<span class="o">$</span>x  <span class="c1"># 变成了2</span>
</code></pre></div>


<p>近两年Chambers大人继历史上推出S3、S4之后，又推出了引用类（reference classes），应该算是补缺吧。值传递虽然有点低效，但更安全一些，不会冷不丁不小心就修改了一个变量。</p>

<p>这么写下去没完没了，不写了，还是写书更重要，就是这样（波波头的微博禅）。</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>回村</title>
      <link>http://yihui.name/cn/2012/08/quo-vadis/</link>
      <pubDate>2012-08-12T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/08/quo-vadis</guid>
      <content:encoded><![CDATA[<p>周五结束了在AT&amp;T实验室的十周实习，却遭遇了一次天留人，原本周五下午的航班因为大雨给取消改到周六，害我在办公室打了一夜地铺。公司安排实习生住在Drew大学（这名字在中文里讲起来很麻烦：你住哪儿？我住在“住”，又或我住在猪大学），条件简陋，一栋楼就一个简单的厨房，冰箱冷藏是室温，于是只好把冷冻当冷藏用，里面塞的东西简直可以考古（气味曼妙，我忍不了的时候偷偷扔了不少别人过期的东西），好歹挨过了两个月。周五下午Drew要赶走所有人，因为要粉刷房子准备开学住新生了，于是几个要搬家的实习生就在门口一堆行李旁胡侃，侃得群情激愤，声泪俱下控诉这苦逼的地方，要吃没得吃，要喝没得喝。扳指一算，吃住行交学费除去，工资所剩无几，实你妹习啊。</p>

<p>当然有一些玩笑成分。生活之所以苦逼，我想和IT民工有关。其实纽约就一个小时火车那么远，以IT民工之宅，定是不愿意进城的。我这两个月一共也就去了两次纽约，一次去<a href="/cn/2012/06/quick-notes/">做报告</a>，一次见同学（Eva同学从大西洋彼岸来）。纽约这地儿我走在其中感到压抑，熙熙攘攘的人群，抬头不见天日，经常出了地铁就迷失方向，所以也不太乐意去。备受赞誉的中央公园在我眼中也就是个相对论问题：纽约太拥挤了，所以这个大公园显得珍贵，对从村里过去的人来说，俺们有一望无际的大农场，这一片绿地也就没什么稀奇了。</p>

<p>上次说到实习让我加强了写Shell脚本的功力，AT&amp;T的科学家们有用Shell脚本处理文本数据的传统（而不是用数据库），我问老板Simon，他说这种方式比数据库快，于是我整天在awk/sed/grep和管道<code>|</code>中折腾（要知道Awk和R都和AT&amp;T实验室有深厚渊源，我的办公室就是S语言作者之一Allan Wilks退休前的办公室，我隔壁是S语言另外一位作者Rick Becker）。Simon一直说内存问题不是R的大问题，我这次才算知道为什么不是大问题了，因为他们有超大内存的服务器（问百姓没饭吃为什么不喝肉粥的皇帝）。实习中我生平第一次把一个6G的文本文件一口气读进R居然没说内存不够，这上哪儿说理去啊？对我等普通青年和普通机器来说，多数时候撑死还是只能读几百M的数据。最后实习汇报的时候，我引用了这幅图说明一个普通青年使用他们的大型服务器的感觉：</p>

<p><img src="http://i.imgur.com/U8KI6.jpg" alt="乌龟太快了" /></p>

<p>每次谈话都能看到Simon的聪明之处，他说话我经常跟不上（等他走了半小时了我才醒悟过来他是咋整的），而我话说一半他的思维就已经超出我一大截了。这家伙的脑子里装的东西真不是一般的多（比如地球纬度上1度大约是多少公里），各类命令背得滚瓜烂熟了如指掌。有一件小事我直到看他操作才意识到：在Linux下鼠标选中文本，然后鼠标中键点下去就可以粘贴了，这在很多程序中都是默认规范。想想过去我浪费了多少次Ctrl+C按键操作啊！</p>

<p>太聪明的人也会有被聪明误的问题，因为太聪明意味着你什么都可以做，我看S大人就有这种倾向：看一些工具不顺眼就开始琢磨自己写个工具替代它。另一个表现就是“配置狂”，意思是不管什么软件都要自定义配置，好像非得自定义一下什么设置才算是真正使用这个软件一样。有时候想想，知道的太多也不一定是好事。</p>

<p>因为数据涉及到隐私问题，实习这事儿不能说太细，不过大数据还是挺好玩的，比如直方图中在59秒挂电话的频数就略微比前后两秒的频数高一点，这让我想起来当年手机刚开始时兴起来的时候，打电话打了59秒就得意洋洋，1分零1秒就要骂娘。这世上有很多把连续数据人为离散化的情形看似自然但我觉得完全不合理，比如电话为什么要以分钟为单位收费，学生的学分为什么要分ABCD(+|-)，奥运成绩为什么要分金银铜，等等；金银是质的区别，但如果金牌是9.98秒而银牌是9.99秒，人的感知可能就很不一样了，而且从统计的意义上来说，二者可能并没有显著差异，如果再跑一次，银牌可能会胜过金牌。苦命的银牌铜牌们，都是统计学发展还不够害的，否则大家也许都并列金牌了。咳咳，我这是说到哪儿去了？</p>

<p>无论如何，没谱的实习结束了，回到了自己的狗窝，还是村里惬意。</p>

<p>附实习期间令我无语的截图两张：</p>

<p><img src="http://i.imgur.com/OGreD.png" alt="没有错误的错误" /></p>

<p><img src="http://i.imgur.com/OdIWF.png" alt="成功的错误" /></p>

<p>外接几篇：</p>

<h2>圣地亚哥JSM</h2>

<p>今年JSM在圣地亚哥开，这个会议我是越来越没兴趣，这次连会议手册都完全没打开过，除了自己的报告之外，纯粹在那边打酱油，不是找认识的人瞎聊几句，就是出去吃饭观光。各类人见了一堆，有些是知道名字但不知面貌，如夏凡、王芳坡（路上偶遇，被叫师兄，我还心想介四谁啊，一起的还有翁银虹，不过时隔几年我已然忘记长啥模样了，汗），人大军团在美帝越来越壮大了；有些人是知名知面但没见过活人，这次好不容易见到活人，如Duncan Temple Lang和John Chambers，我逮到Chambers说你三年前<a href="/cn/2009/04/won-john-chambers-award/">欠我一张照片</a>，于是老大欣然给我补了一张：</p>

<p><img src="http://i.imgur.com/B05Sh.jpg" alt="拜见John Chambers" /></p>

<p>我觉得他应该有七十多岁了（本科毕业五十年了），可是看着也就五十岁的样子，莫非十几岁就读完本科了？其它各种会面会餐暂且不表。</p>

<h2>翻书</h2>

<p>自从<a href="/cn/2011/09/ny-strata-and-nj-att/">有了Kindle</a>，翻了一些闲书。作为一俗人，我真心觉得《明朝那些事儿》写得好，喜感与历史的结合，大赞，这作者不简单（虽然我不知道也不关心是谁）。这个暑假翻完《曾国藩》那三部曲，心理描写太多且细，我也就不关心它的历史性了，作为文学作品看也还不错。曾老爷子留下遗训四条：</p>

<ul>
<li>慎独则心安</li>
<li>主敬则身强</li>
<li>求仁则人悦</li>
<li>习劳则神钦</li>
</ul>


<p>遗训中尽管充满迷信，但精神和原则都值得敬仰。这书到现在有三点印象：</p>

<ol>
<li>运气：曾老爷子晚年反思一生（当然，可能只是本书作者在“反思”），觉得官场上的成功可能还是运气使然（例如太平天国内部腐化）；这让我联想到Michael Lewis（《说谎者的扑克》作者）在普林斯顿的<a href="http://v.youku.com/v_show/id_XNDExNDk1NzY0.html">毕业典礼演讲</a>，其主题便是运气；听起来这有点消极，可谁知道呢？</li>
<li>仁：具体细节不记得了，他最后和某山中大师谈话时，如五雷轰顶般意识到此生战战兢兢顺从满清王室也许未必是真的仁，他不反，可能反而害了天下百姓；</li>
<li>洋务运动：尤其是对容闳办留美幼童的支持，这一百多个幼童里，出了多少绝世将才；</li>
</ol>


<p><embed src="http://player.youku.com/player.php/sid/XNDExNDk1NzY0/v.swf" allowFullScreen="true" quality="high" width="480" height="400" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></embed></p>

<p>最近在机场出入较多，候机无聊之中补了几本金庸武侠，发现兴趣已经不如初高中那时那么大了（还不如看塔屋王世子和深夜食堂），不过倒是在《书剑恩仇录》和《天龙八部》中瞥见小轩哥的网名“解名缰”，有点意思。</p>

<h2>软件外包</h2>

<p>Cameron发了一则通知，<a href="http://cameron.bracken.bz/who-wants-to-maintain-pgfsweave">pgfSweave求包养</a>，想当年我也是积极地给他提交补丁，现在这个包的功能已经完全被knitr涵盖了，所以我琢磨着是否还有人会真的去包养；虽说是后浪推前浪，前浪沙滩上，我还是得感谢pgfSweave赐给我的灵感。</p>

<p>我上次<a href="/cn/2012/06/quick-notes/">也</a>求人包养我不想维护的<a href="https://github.com/yihui/iBUGS">iBUGS</a>包，立刻就有<a href="https://github.com/randel">彪哥</a>来包了。我同样求人简化MSG包中的一个示例代码，经过<a href="https://github.com/yihui/MSG/pull/22">漫长的讨论</a>，终于把肖楠肖帮主出品的<a href="https://github.com/yihui/MSG/blob/master/demo/Napoleon.R">拿破仑行军图</a>的代码清理好了；其实这事情我自己来做的话花的时间会少得多，但潜在的好处是鼓励别人参与你的代码开发，一旦这个能形成趋势，我就等着接受补丁好了。介，揍是<a href="https://github.com/downloads/yihui/yihui.github.com/social-coding-Yihui-Xie-2012.pdf">社交化编程</a>。</p>

<h2>科学与法律</h2>

<p>科学的最高意义<a href="http://www.ted.com/talks/scott_fraser_the_problem_with_eyewitness_testimony.html">莫过于此</a>：</p>

<object width="526" height="374"><param name="movie" value="http://video.ted.com/assets/player/swf/EmbedPlayer.swf"></param><param name="allowFullScreen" value="true" /><param name="allowScriptAccess" value="always"/><param name="wmode" value="transparent"></param><param name="bgColor" value="#ffffff"></param><param name="flashvars" value="vu=http://video.ted.com/talk/stream/2012X/Blank/ScottFraser_2012X-320k.mp4&su=http://images.ted.com/images/ted/tedindex/embed-posters/ScottFraser_2012X-embed.jpg&vw=512&vh=288&ap=0&ti=1560&lang=en&introDuration=15330&adDuration=4000&postAdDuration=830&adKeys=talk=scott_fraser_the_problem_with_eyewitness_testimony;year=2012;theme=how_the_mind_works;event=TEDxUSC;tag=crime;tag=global+issues;tag=government;tag=law;tag=memory;tag=mind;tag=prison;tag=science;&preAdTag=tconf.ted/embed;tile=1;sz=512x288;" /><embed src="http://video.ted.com/assets/player/swf/EmbedPlayer.swf" pluginspace="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" wmode="transparent" bgColor="#ffffff" width="526" height="374" allowFullScreen="true" allowScriptAccess="always" flashvars="vu=http://video.ted.com/talk/stream/2012X/Blank/ScottFraser_2012X-320k.mp4&su=http://images.ted.com/images/ted/tedindex/embed-posters/ScottFraser_2012X-embed.jpg&vw=512&vh=288&ap=0&ti=1560&lang=en&introDuration=15330&adDuration=4000&postAdDuration=830&adKeys=talk=scott_fraser_the_problem_with_eyewitness_testimony;year=2012;theme=how_the_mind_works;event=TEDxUSC;tag=crime;tag=global+issues;tag=government;tag=law;tag=memory;tag=mind;tag=prison;tag=science;&preAdTag=tconf.ted/embed;tile=1;sz=512x288;"></embed></object>


<p>这位演讲者提到“法律与科学长期以来相克”，正义和公平到底是主观还是客观的？老子蹲大牢的时候儿子还在娘胎里，老子被释放之后儿子已经可以跟他一起上大学了。</p>

<h2>抛硬币</h2>

<p>颜大站长在<a href="http://cos.name/cn/topic/107768">这个帖子里</a>间接表扬了我几年前的代码，颜站就是颜站，把代码解释得清清楚楚；我回头来看，难免想起肖帮主最近提到的程序的可读性与效率的平衡，那时候写的代码可读性不高，只是在追求简洁。如果换作今天来写同样的代码，我会这样写：</p>

<div class="highlight"><pre><code class="r">coin_seq <span class="o">=</span> <span class="kr">function</span><span class="p">(</span>v<span class="p">)</span> <span class="p">{</span>
  x <span class="o">=</span> rbinom<span class="p">(</span>n <span class="o">&lt;-</span> length<span class="p">(</span>v<span class="p">),</span> <span class="m">1</span><span class="p">,</span> <span class="m">0.5</span><span class="p">)</span>
  <span class="kr">while</span> <span class="p">(</span><span class="o">!</span>all<span class="p">(</span>x <span class="o">==</span> v<span class="p">))</span> <span class="p">{</span>
    x <span class="o">=</span> c<span class="p">(</span>x<span class="p">[</span><span class="m">-1</span><span class="p">],</span> rbinom<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0.5</span><span class="p">))</span>
    n <span class="o">=</span> n <span class="o">+</span> <span class="m">1</span>
  <span class="p">}</span>
  n
<span class="p">}</span>
set.seed<span class="p">(</span><span class="m">1024</span><span class="p">)</span>
mean<span class="p">(</span>htt <span class="o">&lt;-</span> replicate<span class="p">(</span><span class="m">1e+05</span><span class="p">,</span> coin_seq<span class="p">(</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">))))</span>
mean<span class="p">(</span>hth <span class="o">&lt;-</span> replicate<span class="p">(</span><span class="m">1e+05</span><span class="p">,</span> coin_seq<span class="p">(</span>c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">))))</span>
</code></pre></div>


<h2>Quo Vadis</h2>

<p>最后解释一下这篇日志链接中的Quo Vadis，拉丁语，意思是“何处去”，从Bill Venables长老那里学来的，他在useR! 2012上的<a href="http://biostat.mc.vanderbilt.edu/wiki/pub/Main/UseR-2012/VenablesRQuoVadis.pdf">邀请报告</a>的标题就是这个，意思是想说R何处去。长老表达了对R的几个担忧，我感觉他隐隐剑指某位如日中天的R领军人物，称之为帝国主义。</p>

<p>这些都是闲话。为啥用这个词组作链接呢？其实也没啥特殊原因，本来是想以这个为主题写的，但后来只是觉得它很酷，于是便记载与此。</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>速记</title>
      <link>http://yihui.name/cn/2012/06/quick-notes/</link>
      <pubDate>2012-06-24T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/06/quick-notes</guid>
      <content:encoded><![CDATA[<p>简单罗列一下这两个月发生的事情。</p>

<ul>
<li>5月13日~19日，休斯顿参加<a href="http://www.interfacesymposia.org/Interface2012/Interface2012.html">Interface会议</a>，老板们已经多年不参加这个会议了（江湖闲言按下不表），但今年在Hadley那旮旯举办，所以举团南下

<ul>
<li>在会前两天召开GGobi会议，收效甚微，主要原因大概在本小子过去半年多在cranvas开发上不给力，很久没有动静了</li>
<li>在Hadley家烧烤聚餐，第一次面见JJ Allaire和Joe Cheng一波RStudio的人，也见到R core之一Duncan Murdoch大人，向其抱怨R网站太难看，同时见到：Keith Baggerly，和Kevin Coombes并肩战斗戳穿Duke癌症研究谎言的统计学家，Sweave重度用户，后面再提；Gabriel Becker，SearchTrees包的作者，Michael Lawrence的好搭档，两人一见面就没别的事，张口就是这程序那代码的；Norman Matloff，The Art of R Programming的作者，粤语熟练，会讲一些普通话，我告诉他我们在翻译他的书</li>
<li>会议晚宴上统计学家兼艺术家Mark Hansen的演讲完全不知所云，很多人都觉得很好，但没有艺术细胞的我执着地认为他该下乡去种地（希望他不要看到这里）</li>
<li>会上看到被Gelman大人长期猛烈批评的Wegman大人（这个会议的头号组织者），江湖关系复杂</li>
<li>一如既往没有什么好报告，或者说少有我听得懂的报告，现在出门开会都这样，哥不适合在学术界生存</li>
</ul>
</li>
<li>5月30日上午，RStudio开发者到访Ames村办大学，在村里和我一起讲RStudio和可重复性研究，中午和大二老板四人共进午餐，相谈甚欢，吃完饭大老板一把抓走我的账单，然后跟JJ说你的账单你自己付，我泪流满面，多么实诚又照顾学生的老板啊，在国内吃饭让客人自己买单几乎不可能，文化差异</li>
<li>5月30日下午，JJ开车带我一起去明尼苏达（其实他到Ames村的主要原因就是我开车不熟，不敢一个人开明尼），路上净是谈各种软件，包括Ubuntu的Unity界面是多么恶心，美国人开车总是喜欢双手离开方向盘手舞足蹈……

<ul>
<li>晚上在当地的R小组接着报告，见到了Daniel Kaplan，几乎是自打R出道以来就开始用R的老爷子，我很喜欢他，他学习能力很强，问问题也能一下子问到点子上，现在在RStudio当客服的Paul就是他的学生，两年前RStudio出道的时候他就看准这个编辑器要火了，给RStudio提了很多建议</li>
<li>Org-mode的用户是最顽固的，Emacs果然是一种信仰，可是真的不是每个人都是极客（Org-mode是极客中的极客，反正我是招架不住）</li>
<li>晚上住在Macalester大学的校友别墅，进门就亮瞎了我的狗眼，恐怕我这辈子都住不上这么好的房子，皇宫似的，有所得必有所失这条定律在我身上一直灵验，尽管JJ给我安排了个好住处，但我发现我把电源线忘在会场，第二天一大早飞机，来不及拿了，一周之后JJ送了我一根旧的</li>
<li>前脚刚从明尼飞走，后脚就有当时的听众来信招人做自动化报告</li>
</ul>
</li>
<li>5月31日，飞纽约，在中心极限定理（CLT）机场转机，到新泽西AT&amp;T实验室跟Simon实习</li>
<li>6月5日晚，从新泽西乡下坐火车进纽约城，第三次和JJ报告，给纽约R用户小组，这是个超大的组织

<ul>
<li>见到组织者Drew Conway，也就是Machine Learning for Hackers的作者之一，Drew让人印象极其深刻，块头太大了，像一面墙似的耸立在你面前，我说话说得脖子酸；他本是政治系的，却干着统计的活；我们讲完之后我看他发了一条推特消息：knitr真是个坏屁股！他这是最后一次组织R聚会，因为要毕业走人了，最后交代了下一任组织者</li>
<li>其实这次报告有三个人，第三人是rApache的作者Jeffrey Horner，他和JJ一起把sundown这个库移植到R中，写了个markdown包，也就是RStudio中R Markdown功能的支柱之一；Jeff也是超高个儿，不过还好比较瘦，没那么窒息，真人版比照片帅多了</li>
<li>讲完一伙人去酒吧，哥从小就是好孩子，这是生平第一次进酒吧，我哪儿知道酒名，酒吧里吵得要命，听不清，于是要了杯可乐，我就是这么土；和一些一直有邮件联系但素未谋面的人聊了两个小时，最后下一任组织者专门要了一瓶度数比较高的酒请我和Jeff，算是代表组织者感谢一下，那小伙也是knitr粉丝，正在写一本书，其中专门用一章介绍knitr</li>
<li>半夜才从城里回到乡下，三次报告其实都是为了最后一次大报告排练的</li>
</ul>
</li>
<li>6月12日~16日，一个人来到田纳西，useR! 2012会议，创了个纪录，给了三场演讲

<ul>
<li>第一场讲cranvas，之前在休斯顿的报告烂得不堪回首，这次做了个大胆的决定，把幻灯片扔掉，只有代码，上来二话不说就讲第一个例子，就这样一直讲到最后一个例子，没有简介、动机、实现、示例和总结，事实证明这是个无比正确的决定，讲完震惊了Bill Venables长老，老板也非常高兴，兴奋地上来跟我击掌</li>
<li>第二场讲社交化编程，其实就是讲Github，把SVN痛批一顿，最近半年的确在Github上获益良多</li>
<li>第三场是邀请报告，这次是狗屎运，第一次做邀请报告，也就是和JJ排练了三遍的可重复性研究报告，这次演讲基本达到了效果，电闪雷鸣的观点让很多人都下定决心转向knitr</li>
<li>这三场报告可能是我这些年近五十场报告中讲得最好的，主要是插入笑点最多，恶搞料足，这也是我演讲最看重的元素，不是为了哗众取宠，而是为了让听众集中精神，这是演讲有效的前提；后来大家纷纷问我是不是在电视台有第二职业……这些笑话也震撼了Frank Harrell主席，我跟他说大概是继承我爹吧，回头我看推特，有日本听众这样描述

<blockquote><p>もう一つ言うと、昨日紹介したRでマインスイーパーのあれつくったのもknitrの作者と同じ。この人プレゼンがすごく面白くて会場に爆笑の嵐を起こしてる</p></blockquote></li>
<li>附图两张
<img src="http://i.imgur.com/cs0lG.jpg" alt="useR! 2012" />
<img src="http://i.imgur.com/GPFxG.jpg" alt="useR! 2012" /></li>
<li>第一次看见Frank的时候，我几乎悲从中来，我08和10年分别在useR!上听过他的课，精神矍铄，但这次却弯腰拄着跟拐杖，我心想怎么两年就老成这样了，后来才知道是最近刚受伤了；Frank见到我紧紧握住我的手，说你那个fig.cap和cache选项真是好用啊，我一直在用</li>
<li>第一天欢迎酒会上，见到一位Genentech的大叔，JJ向他介绍这就是写knitr的那位先生，他看到我的名字，一下子冲上来抱住我左一口右一口……幸好是个男的，不然我要麻烦了</li>
<li>这次useR!上给我捧场的人实在太多了，邀请报告中就有两场提到knitr，其中Kevin Coombes还专门用一张片子介绍了knitr，让我倍感荣幸，半年前我和他争论过，现在看来他已经接受knitr了，估计是Keith回去吹风了；如果你没听过<a href="http://www.cbsnews.com/video/watch/?id=7398476n">Duke那个丑闻</a>的话，建议一定去看看，不可重复的研究（复制粘贴）真的是会害死人的，已经有几位病人因为那个错误的研究结果丧命；我之所以感到无比激动，就是因为有这个背景</li>
<li>在田纳西多谢Pengcheng的热情招待，既是湖北老乡，又是Ames村办大学校友，带我四处吃喝玩乐，招待太周全了，非常感动；一起吃饭的两位台湾朋友也很聊得来，我这次算是知道了，凡是在台湾搞统计的，几乎不可能跟谢邦昌老师没有关系；说起赵民德老爷子，一致认为他像金庸小说里的大侠（洪七公？），若干年前他在人大讲写论文的讲义我至今还偶尔翻出来读一读，写的真是非常好，在我看过的所有文章中，我认为唯一有希望赶上这位老爷子的，只有<a href="http://cos.name/2012/05/chase-after-eb/">杨灿</a>一人</li>
</ul>
</li>
<li>我们有没有输出价值观我不知道，但中国可以向外输出R了

<ul>
<li>肖楠的日志在<a href="http://stackoverflow.com/q/11056032/559676">StackOverflow</a>上被引用，我用功夫熊猫中的一句话评论：This is a sign</li>
<li>第五届中国R语言会议的扑克牌传到了Terry Speed长老手中，长老对此爱不释手欣喜若狂，称不惜一切代价要从中国多买一些，这位长老在统计界是中神通王重阳级别的人物，让我心情非常冲动，这又是统计之都之“人本”精神的绝佳体现，该加5分</li>
</ul>
</li>
<li>论文

<ul>
<li>animation包的论文历经约一年半时间，终于被接受了，真慢，跟主编争论有点无聊，不怕神一样的对手，就怕LaTeX中毒的主编</li>
<li><a href="/en/2012/03/a-really-fast-statistics-journal/">我期待</a>传统论文评审和发表形式的死亡，被人告知Elsevier已经在这方面作出努力了：<a href="http://www.articleofthefuture.com/">Article of the Future</a></li>
</ul>
</li>
<li>被偷东西一般不是什么好事，但要看是谁来偷了，被高手偷是一种荣幸

<ul>
<li>我<a href="http://biostat.mc.vanderbilt.edu/wiki/Main/VenablesShortCourse">看见</a>Bill Venables<a href="http://biostat.mc.vanderbilt.edu/wiki/pub/Main/UseR-2012/VenablesRQuoVadis.pdf">偷了</a>我在knitr中定义的LaTeX样式</li>
<li>Jeroen Ooms在他的OpenCPU中<a href="http://public.opencpu.org/R/pub/stats/glm/help/html?">偷了</a>我的<a href="https://github.com/yihui/configuration/blob/master/R.css">CSS</a></li>
<li>在Github上fork（谁能给这个词一个翻译？）不算偷，不过被fork也是一种荣幸，knitr的fork队伍中有R大佬Douglas Bates和可重复研究的大佬及cacheSweave作者Roger Peng，目前Github上knitr的fork数量在<a href="https://github.com/languages/R">R类</a>库中已经超越ggplot2排名第二，这就是社交化编程的体现，去中心化，让有能力的用户自己提交补丁实现他们预期的功能（闭源软件的灭绝只是时间问题）</li>
</ul>
</li>
<li>GSoC

<ul>
<li>太云<a href="http://www.google-melange.com/gsoc/project/google/gsoc2012/cloud_wei/16001">入围</a>Google编程夏令营，我们要掀起一场革命，看看在社区合作时代，knitr+Github能否取代（至少影响）一些旧式的刊物（如The R Journal）或网站（如R Graph Gallery），这将会是一个非常有意思的探讨</li>
</ul>
</li>
<li>文债

<ul>
<li>欠了一屁股文债，每天狂写，可还是有一批虎视眈眈的任务等着</li>
<li>多年没联系的王学枫来电，说整一本高水平的R语言书，我说我的忍者扔那儿又是三个月了</li>
<li>C&amp;H出版社默默期待着可重复研究的书稿大纲，我自刎八回都不足以赎罪</li>
<li>上一个书稿大纲还没整完，又有拼书的来约一章了，我都不敢回复了</li>
<li>现代统计图形咬牙重新启动，希望这次在COS一帮人的帮助下能完成第二次排版及修订任务，前面排长队要书稿的可能近期能收到我的回复了，我知道我自刎八十回都不足以谢罪了</li>
</ul>
</li>
<li>其它

<ul>
<li>阳志平写了一篇非常抬举knitr的<a href="http://www.yangzhiping.com/tech/r-markdown-knitr.html">文章</a>，这事儿以后再说，关键是我好像在微博上看见ox评论这篇文章了，李舰问是不是天地人大那个ox，我也有此疑问，因为那个牛跟我是老乡，那时候天地人大上的名ID啊，十年前军训时听说楼上班里有个宜昌人，还兴冲冲去找他来着</li>
<li>在Github上观察了若干强人，其实国内那种“少林寺扫地僧”式的高手还是不少的（如宫雨老师），例如我觉得<a href="https://github.com/lq">lq</a>就是这样；Github真是一个近距离观察各类神人出招的好地方</li>
<li>COS论坛因为是一直盯的地方，所以不会有神的感觉，但这两年明显可以看到一批人的进步，比如肖楠已然成为一方大侠，主伟呈在许三多式成长</li>
<li>还是COS论坛，我们该拿坛霸怎么办？坛霸就是屁大点儿事统统都发出来问星人，我个人觉得每周问三五个问题的频率可以接受，但每天都扔出来十来个问题似乎太夸张了，一方面，我们要珍惜志愿者劳动，另一方面，你好歹也要有点自学能力吧，志愿者不是奶妈</li>
<li><p>在AT&amp;T实习最大的收获可能是shell脚本，各种awk/sed乱入几G的数据，关于shell脚本，举个例子，我住的宿舍无线网络不好，经常掉线，只能重启，我搜了很久终于找到不用重启的办法，就是卸载再加载无线网络模块，于是我写了个无限循环，我叫你掉线，我叫你掉线，……
    #!/bin/sh</p>

<pre><code>while true
do
  ifconfig | grep -q 10.2.13 &amp;&amp; true || (sudo rmmod iwlwifi;
     sleep 1; sudo modprobe iwlwifi; sleep 30; echo rebooted wireless)
  sleep 1
done
</code></pre></li>
</ul>
</li>
<li>各位客官，你能帮我吗？我有一些杂项任务

<ul>
<li>MSG包中有一个<a href="https://github.com/yihui/MSG/blob/master/demo/Napoleon.R">拿破仑行军/撤退路线图</a>，基于Google Maps，肖楠出品，你能用循环帮我把它改短一些吗？</li>
<li>有一位强人Wush Wu愣是用R写了个<a href="https://github.com/yihui/knitr/blob/master/R/utils-base64.R">base64编码的函数</a>，我的问题是，它能向量化吗？即：避免循环。</li>
<li>R 2.16.0将会增加一个<code>getParseData</code>函数，你能帮我改进<a href="https://gist.github.com/3146836">这个代码高亮函数</a>吗？我已经把基本工作做完，剩下的主要工作是把空格加回来，因为这个函数会丢弃空格，你要么从行列号反推空格的位置，要么把原代码的符号（token）替换为高亮版本，这是一个血腥细节问题，我不想杀脑细胞</li>
<li>我有一个丢弃了两年的<a href="https://github.com/yihui/iBUGS">iBUGS包</a>，你想学习用gWidgets做图形界面吗？想学的话，我可以把这个包转让给你，我不想维护它了</li>
<li>你能帮忙整理COS论坛素材添加到<a href="https://github.com/yihui/r-ninja">忍者秘笈</a>吗？</li>
</ul>
</li>
</ul>

]]></content:encoded>
    </item>
    
    <item>
      <title>分段回归的拐点连续性</title>
      <link>http://yihui.name/cn/2012/04/break-points-in-regression/</link>
      <pubDate>2012-04-30T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/04/break-points-in-regression</guid>
      <content:encoded><![CDATA[<p>我翻了一下，<a href="/cn/2010/12/unifying-bayesians-and-frequentists/">上一次写</a>跟统计有关的话题已经是2010年的事情了，多数时候，这里写的都是（计算机）技术类与生活类的话题，于是我又想起来很久以前有客官说，你还不如改成“Keep on eating”算了。废话少说，言归正传。</p>

<p>最近有客官问：</p>

<blockquote><p>在分段线性回归中，转折点的连续性是必须的吗？</p></blockquote>

<p>意思是这样，下图中，两段直线应该接着呢（实线），还是可以各走各的（虚线）？</p>

<div class="highlight"><pre><code class="r">set.seed<span class="p">(</span><span class="m">123</span><span class="p">)</span>
<span class="c1"># 真实模型</span>
x <span class="o">=</span> sort<span class="p">(</span>runif<span class="p">(</span><span class="m">100</span><span class="p">))</span>
y <span class="o">=</span> <span class="m">2</span> <span class="o">+</span> <span class="m">1</span> <span class="o">*</span> x <span class="o">+</span> <span class="m">4</span> <span class="o">*</span> <span class="p">(</span>x <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="m">3</span> <span class="o">*</span> <span class="p">(</span>x <span class="o">-</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>x <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span> rnorm<span class="p">(</span><span class="m">100</span><span class="p">)</span>
par<span class="p">(</span>mar <span class="o">=</span> c<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> family <span class="o">=</span> <span class="s">&quot;serif&quot;</span><span class="p">,</span> mgp <span class="o">=</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>
plot<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> pch <span class="o">=</span> <span class="m">20</span><span class="p">,</span> col <span class="o">=</span> <span class="s">&quot;darkgray&quot;</span><span class="p">)</span>
<span class="c1"># 斜率不同，截距限制</span>
fit1 <span class="o">=</span> lm<span class="p">(</span>y <span class="o">~</span> <span class="m">1</span> <span class="o">+</span> x <span class="o">+</span> I<span class="p">((</span>x <span class="o">-</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>x <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)))</span>
lines<span class="p">(</span>x<span class="p">,</span> fitted<span class="p">(</span>fit1<span class="p">),</span> lwd <span class="o">=</span> <span class="m">2</span><span class="p">,</span> col <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
<span class="c1"># 斜率不同，截距也不同</span>
fit2 <span class="o">=</span> lm<span class="p">(</span>y <span class="o">~</span> <span class="m">1</span> <span class="o">+</span> x <span class="o">+</span> I<span class="p">(</span>x <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span> I<span class="p">((</span>x <span class="o">-</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>x <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)))</span>
lines<span class="p">(</span>x<span class="p">,</span> fitted<span class="p">(</span>fit2<span class="p">),</span> lwd <span class="o">=</span> <span class="m">2</span><span class="p">,</span> lty <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/oicZb.png" alt="plot of chunk linmod" /></p>

<p>虚线线段的中间一段不应该被画出来，我偷了个懒画上去了，本来应该是间断的。连与不连，归根结底，只不过是回归设计阵要不要多一列的问题。这是线性回归中经典的模型比较问题，上面<code>fit2</code>是全模型，<code>fit1</code>是取消一个限制的模型，自由度之差为1，残差平方和之差除以1，再除以全模型的残差平方和除以相应自由度（88/96），就是F统计量，P值也就出来了。R里面所谓的<code>anova()</code>函数，就是干这事儿的：</p>

<div class="highlight"><pre><code class="r"><span class="c1"># 两个嵌套模型做F检验</span>
anova<span class="p">(</span>fit1<span class="p">,</span> fit2<span class="p">)</span>
</code></pre></div>




<div class="highlight"><pre><code class="text">## Analysis of Variance Table
## 
## Model 1: y ~ 1 + x + I((x - 0.5) * (x &gt; 0.5))
## Model 2: y ~ 1 + x + I(x &gt; 0.5) + I((x - 0.5) * (x &gt; 0.5))
##   Res.Df RSS Df Sum of Sq    F  Pr(&gt;F)    
## 1     97 155                              
## 2     96  88  1      66.6 72.6 2.2e-13 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
</code></pre></div>


<p>这里因为我们设计的真实模型就是两部分直线斜率和截距在0.5前后都不同，所以这里F检验高度显著，说明加上截距限制条件不合理。道理很简单：除非简约模型和全模型没有显著差异，我们只能认为全模型相对“好”一些。</p>

<p>然而，线性模型本身就是对现实的简化。按照上面的想法，其实我们还需要看更复杂的全模型，否则不能认为线性模型就是合适的模型，比如可以考虑非线性模型。复杂模型是没有尽头的，如果要一个个检查下去，那大家都不用干活了。2008年我在COS写了一篇简单的<a href="http://cos.name/2008/11/lowess-to-explore-bivariate-correlation-by-yihui/">LOWESS文章</a>，如今我仍然可以把它搬出来，因为LOWESS实在是回归模型中的战斗机，它是模型复杂与简约的很好平衡。前面的直线回归可以看作LOWESS的特例，如下<code>fit4</code>。我们可以构造一个相对复杂的LOWESS模型（<code>span</code>参数取小一些），然后和一个简单的模型比较，如：</p>

<div class="highlight"><pre><code class="r">fit3 <span class="o">=</span> loess<span class="p">(</span>y <span class="o">~</span> x<span class="p">,</span> span <span class="o">=</span> <span class="m">0.2</span><span class="p">)</span>
fit4 <span class="o">=</span> loess<span class="p">(</span>y <span class="o">~</span> <span class="m">1</span> <span class="o">+</span> x <span class="o">+</span> I<span class="p">(</span>x <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span> I<span class="p">((</span>x <span class="o">-</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>x <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)),</span> span <span class="o">=</span> <span class="m">1</span><span class="p">,</span> 
    degree <span class="o">=</span> <span class="m">1</span><span class="p">)</span>
par<span class="p">(</span>mar <span class="o">=</span> c<span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span> family <span class="o">=</span> <span class="s">&quot;serif&quot;</span><span class="p">,</span> mgp <span class="o">=</span> c<span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">))</span>
plot<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> pch <span class="o">=</span> <span class="m">20</span><span class="p">,</span> col <span class="o">=</span> <span class="s">&quot;darkgray&quot;</span><span class="p">)</span>
lines<span class="p">(</span>x<span class="p">,</span> fitted<span class="p">(</span>fit3<span class="p">),</span> lwd <span class="o">=</span> <span class="m">2</span><span class="p">,</span> col <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
lines<span class="p">(</span>x<span class="p">,</span> fitted<span class="p">(</span>fit4<span class="p">),</span> lwd <span class="o">=</span> <span class="m">2</span><span class="p">,</span> lty <span class="o">=</span> <span class="m">2</span><span class="p">)</span>
</code></pre></div>


<p><img src="http://i.imgur.com/nGVDw.png" alt="plot of chunk loess-comparison" /></p>

<div class="highlight"><pre><code class="r">anova<span class="p">(</span>fit3<span class="p">,</span> fit4<span class="p">)</span>
</code></pre></div>




<div class="highlight"><pre><code class="text">## Model 1: loess(formula = y ~ x, span = 0.2)
## Model 2: loess(formula = y ~ 1 + x + I(x &gt; 0.5) + I((x - 0.5) * (x &gt; 0.5)), span = 1, degree = 1)
## 
## Analysis of Variance:   denominator df 82.38
## 
##        ENP  RSS F-value Pr(&gt;F)
## [1,] 15.16 83.2               
## [2,]  4.02 87.7   0.321   0.99
</code></pre></div>


<p>P值很大，这毫不奇怪，因为真实模型就是按照两段直线构造的。弯弯曲曲的复杂模型无法打败简单模型，此时我们可以有点底气说两个线段的直线回归可能是对数据的一个恰当描述。</p>

<p>客官的第二个问题是：</p>

<blockquote><p>转折点怎么确定？</p></blockquote>

<p>好问题。我对学术研究其实没多大兴趣，所以懒得去文献堆里翻找。我总觉得很多研究是把问题复杂化了，这种文献海让我觉得窒息。如果是我，第一步肯定是画平滑曲线，然后再去结合具体事件背景去决定。如前面的数据用<strong>ggplot2</strong>很容易分组画图：</p>

<div class="highlight"><pre><code class="r">library<span class="p">(</span>ggplot2<span class="p">)</span>
qplot<span class="p">(</span>x<span class="p">,</span> y<span class="p">)</span> <span class="o">+</span> geom_smooth<span class="p">()</span>  <span class="c1"># 总趋势</span>
</code></pre></div>


<p><img src="http://i.imgur.com/Va7An.png" alt="plot of chunk loess" /></p>

<div class="highlight"><pre><code class="r">qplot<span class="p">(</span>x<span class="p">,</span> y<span class="p">,</span> group <span class="o">=</span> x <span class="o">&gt;</span> <span class="m">0.5</span><span class="p">)</span> <span class="o">+</span> geom_smooth<span class="p">()</span>  <span class="c1"># 按0.5前后分组</span>
</code></pre></div>


<p><img src="http://i.imgur.com/J3cg2.png" alt="plot of chunk loess" /></p>

<p>显然所有数据放一条线上建模不合适。作为普通青年的我，到此就止步了（所以我离学术还十万八千里）。不过作为二青年想起一件事，如果不知道转折点，而靠不断推移转折点、新建模型、比较模型得来的转折点，是否有多重比较的嫌疑？比如先试0.2为转折点，再试0.3，……，一直试到0.9，看哪个模型跟全模型比起来没有显著差异。或者说，如果本来真实模型中不存在这样一个转折点，而通过这种方法找出转折点的概率有多大？我估计我八成问了一个很二的问题，应该早有人研究过了。做个模拟应该也不难。</p>

<hr />

<p>本文是我第一次在博客里尝试<strong>knitr</strong>包，点击<a href="https://github.com/yihui/cn/blob/gh-pages/_posts/_2012-04-30-break-points-in-regression.Rmd">这里看源文件</a>以及<a href="https://github.com/yihui/cn/blob/gh-pages/_posts/_knit-all.R">编译代码</a>。关于<strong>knitr</strong>，待我下回在COS详细分解（<a href="https://github.com/yihui/r-ninja/blob/master/11-auto-report.md">预览</a>）；昨天刚提交0.5版本到CRAN，最终实现了我的初步理想：会R就会动态生成报告，把LaTeX扔一边儿去吧！</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>功能地狱</title>
      <link>http://yihui.name/cn/2012/04/reference-and-footnote/</link>
      <pubDate>2012-04-09T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/04/reference-and-footnote</guid>
      <content:encoded><![CDATA[<p>Cloudly大人最近奋发图强，捡起来两年前的<a href="https://github.com/cloudly/Play-Econometrics-with-R">计量经济学小册子</a>，又开始奋笔疾书。讨论到交叉引用的事情时，我觉得这就是锤子钉子的故事：因为我们有<code>\ref{}</code>的能力，所以下意识就会拼命用，定理5引用例子3，图8引用页2，每引用一次就是给自己的作品缠上一道线，写完一本书我们就成茧子了。世上最容易读的作品肯定是给小孩读的，那么童话故事就是一个很好的参照，下面我给大家讲一个《青蛙王子》的故事：</p>

<blockquote><p>标题：青蛙王子</p>

<p>作者：格林兄弟（脚注：作者单位……邮箱……通讯地址）</p>

<p>一、引言</p>

<p>在遥远的古代，人们心中的美好愿望往往能够变成现实。就在那个令人神往的时代，曾经有过一位国王（参见第2章）。国王有好几个女儿，个个都长得非常美丽（张三，公主列传文献1，1784）；尤其是他的小女儿，更是美如天仙（见图1）（脚注1：就连见多识广的太阳，每次照在她脸上时，都对她的美丽感到惊诧不已）。</p>

<p>二、研究动机</p>

<p>国王的宫殿附近，有一片幽暗的大森林（李四，建筑史文献2，1812）。在这片森林中的一棵老椴树下，有一个水潭，水潭很深（王五，地理志文献3，1825）。在天热的时候，小公主常常来到这片森林，坐在清凉的水潭边上。她坐在那里感到无聊的时候，就取出一只金球，把金球抛向空中，然后再用手接住。这成了她最喜爱的游戏（如图2所示，数据见表1）。</p>

<p>表格1：公主扔球数据</p>

<p>时间 温度 速度 结果<br/>
14:29 32 5m/s 接住<br/>
14:31 32 3m/s 接住<br/>
....<br/>
14:52 30 7m/s 没接住</p>

<p>不巧的是，有一次，小公主伸出两只小手去接金球（见第78页），金球却没有落进她的手里，而是掉到了地上（如表1所示），而且一下子就滚到了水潭里。</p>

<p>……</p></blockquote>

<p>当然这么说有些夸张了，但现在有哪篇学术文章不是这个范儿？</p>

<p>上次我提到Rework，后来有客官表扬我是一只大青蛙。本青蛙略冤，蹲井里再琢磨了一下，其实我并不是说Rework说的不对，只是不知道它是否适合我，关于这事儿的八千字以后有机会再写。先说一件事，这本书是一本易读的书，每一篇长度在一页到一页半之间，每一篇都有整页插图，字大行距大。没有文献列表，如果要引用，就直接用文字把要引用的内容讲述一遍，读者可以以任意顺序阅读，不必从第8页跳回第3页，或从第5页跳到参考文献列表去找那该死的张三（2002）到底是神马东西。</p>

<p>最近几个月在推Markdown，意思并非是说LaTeX需要被取代，而是基于这样一个想法：我们的写作究竟有多大概率需要复杂的排版？如果这个概率小，那为何不先用一个相对简单的排版工具呢。MD是一个弱到爆的标记语言（严格来说它不算标记语言），你要是从LaTeX的角度来问：它能干这个那个吗？答案通常是非常肯定的：不能！问题是，我写日志、写作业、写简单的数据分析报告，需要“这个那个”功能吗？</p>

<p>给<a href="http://www.icsa.org/bulletin/">泛华统计协会</a>又灌水一篇，讲<a href="/en/2012/06/enjoyable-reproducible-research/">让可重复性统计研究欢乐起来</a>。写这篇文章的时候我想起129合唱，那时候每晚练歌让我真心讨厌这个活动，费这么大劲在校内几个院系里夺个名次有毛线用，和129有毛线关系。可重复研究和LaTeX绑在一起就是这个感觉，文学化编程不能因为Knuth用TeX就和TeX绑在一起。在这个网络时代，各种技术都成熟了，何不让大家欢乐地进行可重复统计研究呢？MD易学易用，我们再稍微花点心思把默认的CSS调得漂亮一点，不就轻易说服用户放弃不可重复的复制粘贴了么。用我文中借用别人的一句话：要推广好习惯的最好办法就是让好习惯比坏习惯更简单。</p>

<p>话虽这么说，我仍然是重度LaTeX用户一枚，乐此不疲研究暗黑魔法。</p>

<p>注：本文本写于4月初，但真正发出来已经7月末了……</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>春游记</title>
      <link>http://yihui.name/cn/2012/04/spring-tour/</link>
      <pubDate>2012-04-08T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/04/spring-tour</guid>
      <content:encoded><![CDATA[<p>昨天琢磨着要出门溜达一圈去，今儿个早上起床开着自行车就去河边了。河边都是树林，溜达了一个时辰往回走，手机拿出来随手拍两张。</p>

<p><img src="http://i.imgur.com/yXzBt.jpg" alt="" /></p>

<p>这个小河湾和我家那边有些许相像，小时候在这种浅浅的河里站着，水从脚上流过，总让我感觉水没动，而是我被河底载着在往相反的方向移动，所以在河里总是站不稳，晕得慌，舅舅家里的哥哥姐姐就解释这是盐吃少了，那时候屁大点孩子，当然别人说什么都信；我不是牛顿，被苹果砸就能砸出万有引力，只能信了这个缺盐理论，嗨，想当年，相对论离哥其实就一步之遥，谢因斯坦就在河里捞鱼摸虾中没影了。</p>

<p><img src="http://i.imgur.com/2gshj.jpg" alt="河滩" /></p>

<p><img src="http://i.imgur.com/SHXlI.jpg" alt="大江东去" /></p>

<p>站在河堤上感觉腿给刺扎了，低头一看，一根不知名的草木棍子，枯了半截，上面一支新芽，下面一排刺。</p>

<p><img src="http://i.imgur.com/9snUy.jpg" alt="" /></p>

<p>某文艺青年正在研究手机相机设置，突然身后传来一阵鸟叫，叫的节奏跟狗似的，开始没注意，但我在拨弄相机给刺棍子拍写真时，那鸟狗好像一直冲我叫，于是我转身一看，霍哦，原来是只松鼠：</p>

<p><img src="http://i.imgur.com/V9Mvi.jpg" alt="" /></p>

<p>本村松鼠多，但松鼠叫还真是头一次听到（今天在林子里还头一次听见啄木鸟的声音了，果真是好鼓手，那敲的节奏）。那松鼠就趴在一根枯树枝上，冲我叫个不停，我不知道它是什么意思，反正我看着很欢乐，于是给它<a href="http://v.youku.com/v_show/id_XMzc4MjUxMTcy.html">录了一段</a>：</p>

<p><embed src="http://player.youku.com/player.php/sid/XMzc4MjUxMTcy/v.swf" allowFullScreen="true" quality="high" width="300" height="520" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash" /></p>

<p>它高高在那儿爬上爬下叫个不停，于是我跟它来了一段<a href="http://v.youku.com/v_show/id_XMzc4MjUxNzYw.html">对话</a>，具体说的是什么，各位客官自己猜好了。最神奇的是，本来它在哪儿乱叫，后来我说五个字，它也说五个字，松鼠都会数数了，这可真是了不得了：</p>

<p><embed src="http://player.youku.com/player.php/sid/XMzc4MjUxNzYw/v.swf" allowFullScreen="true" quality="high" width="500" height="400" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash" /></p>

<p>游记完毕。</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>归去来兮</title>
      <link>http://yihui.name/cn/2012/03/as-years-go-by/</link>
      <pubDate>2012-03-23T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/03/as-years-go-by</guid>
      <content:encoded><![CDATA[<p>每次写新的日志之前要先清理一下旧日志，因为<a href="/cn/2012/02/hello-jekyll/">搬家</a>把很多文章的格式都弄乱了，尤其是几乎所有的图片链接都成了死链接，都得重新传，所以写得越来越慢。有客官对此还<a href="http://cos.name/cn/topic/106355">专门分析</a>了我的博客写作数据，发现我的篇数越来越少，字数越来越多，间隔越来越长。比如下图是我的相邻日志日期间隔，最高的那个点就是我说要从WP搬家到Jekyll之后等待的时间，从2011年的最后一篇到2012的第一篇足足过了三个多月：</p>

<p><img src="http://i.imgur.com/w0TcS.png" alt="日志间隔时间" /></p>

<p>开会后跟<a href="http://tengfei.name">腾飞</a>聊网站这些事儿，这厮小时候肯定有一篇课文没背好，就是《小猫钓鱼》。我一直相信热心必须有耐心相伴才能成事；COS团队里有时候有人因为白天聊了一些宏图大业的事情而激动得半夜睡不着觉，我对这种现象的第一反应往往是怎么维持这种热情。几年前我在论坛贴了一篇丰子恺的<a href="http://cos.name/cn/topic/101097">《渐》</a>（美其名曰“文化建设”），这也是我这几年反复读反复引用的文章；道理极其朴素，但把它读进心里不容易。</p>

<p>前些日子我请<a href="http://fan.cos.name">范总</a>点评一组幻灯片，范拎出里面一句话，曰“投资的成就根本是哲学的成就”。我搞不清楚什么技术分析或量化分析，也不知道什么哲学，不过这句话听起来很符合我的胃口。</p>

<hr />

<p>我用“归去来兮”作标题，和陶渊明没关系，只不过是我去年11月想的一个标题而已。一个五年多没联系的师弟突然来信，让我顿时有种恍如隔世的感觉，于是拟题归去来。那时候我还在远大前程协会混迹，挂名副会长，其实就是网管，然后一起拎着讲座海报去各个宣传栏里贴。这师弟是协会的骨干分子，最深的印象就是整天熬夜，只要我早上在路上看见他，大多都是头发蓬乱熬完夜从楼里走出来。他找到我的原因是因为看了COS主站上<a href="http://cos.name/2011/08/meaning-of-traveling/">侯瑀的文章</a>，这事儿就有点趣了，因为他不是统计系的，一个非统计系的工作人士跑来COS看我们的文章，说明我们单篇文章的影响力还是挺深远的。侯瑀同志真是激励了不少人啊。这是从COS找到我的，还有一个更久以前一个从小轩哥的博客找到我的十来年没联系的高中同学，这个更让我不得其解。人生不见，动如参商。</p>

<p>五年前我说<a href="/cn/2007/11/awesome-scalable-vector-graphics/">SVG太牛了</a>，当时称浏览器支持还很欠缺，连Firefox对SVG动画支持都不太好；五年后，Chrome浏览器都已经出来了，大多数浏览器都支持SVG了。现在我开始研究<a href="https://github.com/mbostock/d3/">D3</a>，它画图的一个重要媒介就是SVG，而且动画的语法非常简单。Chrome自带的控制台也很牛，可以直接在浏览器内用JS代码操纵HTML或SVG元素，感觉跟用R差不多了。</p>

<p>四年前我<a href="/cn/2008/08/an-introduction-to-processing/">看到Processing很惊叹</a>，也提到那位大神把Processing翻译为JavaScript库，前些天有客官在我那篇日志下留言，我突然发现如今这个JS库已经成长为<a href="http://processingjs.org/">一个大网站</a>，还有各种在线编辑器，再次激起学习欲望。</p>

<p>七八年前我看到UCLA的<a href="http://www.ats.ucla.edu/stat/">一些统计软件教程</a>，觉得做得挺不错；如今他们的<a href="http://www.ats.ucla.edu/stat/r/code/">R教程</a>已经开始用我的<strong>knitr</strong>包进行改写，让网页和R代码无缝结合，直接从源代码编译为带结果的HTML页面输出，无需任何复制粘贴。我觉得他们的志愿者劳动应该发扬光大再上新台阶，因此决定带一队人马去帮忙把这个网站好好整一整，也算是对免费资源贡献者的回报。</p>

<p>四年前<a href="/cn/2008/06/back-from-bremen/">我在不莱梅</a>第一次见到AT&amp;T的Simon、Debby和现在ISU的老板们，两年前周老师溜达到我的网站约书，两个月后<a href="/cn/2010/07/3rd-chinese-r-conference-beijing/">我在北京</a>第一次见到卢大编辑，去年通过老板支持和卢大编辑牵线<a href="/cn/2011/09/ny-strata-and-nj-att/">去纽约</a>参加Strata会议，顺便就去AT&amp;T溜达一圈，又见了Simon和Debby，由D接待<!--，今年暑假又要去Simon那旮旯了，这实习实际上是用四年投了一封“简历”-->。后面二十字暂按下不表。</p>

<p>五年前我脑子抽风写了个<strong>animation</strong>包，纯属为了好玩，第二年去德国溜达一圈，第二年冬天开始第一届中国R语言会议（今年第五届），第三年上半年中奖，第三年下半年来了<a href="http://www.iastate.edu">爱姆斯村办大学</a>。第五年就此事给ICSA<a href="http://icsa.org/bulletin/issues/ICSABulletin12Jan.pdf">灌了一篇水</a>，并把编辑大人Yan老师拐进COS主站。</p>

<p>COS主站一直有一个问题困扰着我，就是我们没有合适的logo标志图片，等了三年，我们等来了李龑，操起家伙解决了我们的问题，从此我们有了统计之印。COS成员这些年来来去去，偶尔会看见论坛上有注册了五年才第一次发言的会员；还有曾经有辉煌灌水战绩的会员<a href="http://cos.name/cn/topic/104024">去而复归</a>，比如大家都熟悉的colinisstudent；还有主力管理员如无痕那小子，高考完就混迹论坛，后随我一起做网站苦力，现在已经从美帝溜完一圈回朝了，而我们的新管理员们也在奔美帝。</p>

<p>去年G_will<a href="/cn/2011/10/back-into-the-dust/#comment-429725642">留言说</a>可以看看《Rework》，现在我已经看完别人寄给我的这本书，觉得还挺有收获的，不过总觉得观点有点偏激，让我心里又萌生了一些矛盾；同时寄来的还有我喜欢的<a href="/cn/2008/11/habits-of-effective-manager/">德鲁克</a>，这两本书风格当然截然不同，一个是叛逆后进，一个是经典大师，孰是孰非，仍然是小马过河的问题。若按照老式的一份耕耘一份收获原则，Rework看起来很轻浮，道理一看就懂，公交车加饭后几天就翻完了，所以可能真的只是一时的噱头；德鲁克读起来则慢得多，因为不得不停下来琢磨里面的逻辑，经常看了后面忘了前面，也许会更有收获。无论如何，让事实去检验吧。</p>

<p>九年前，奶奶过世。二十年前她还让我们兄弟几个<a href="/cn/2010/12/wisdom-of-zhou-libo/">大的让着小的</a>，从手帕里拿给我们两毛钱去买乒乓球，爷爷用锯子给我们锯球拍；十三年前她从我卧室窗户递给我腊肠带去学校；十年前我从北京回家她还在外面晒太阳。</p>

<hr />

<p><a href="/cn/2012/02/hello-jekyll/">上上篇日志</a>说到我在整理过去日志的时候发现四点问题，方方同学颠儿颠儿冒出来说“木有啊，很实在啊”。我板上钉几颗钉子试试：五年前我自以为是<a href="/cn/2007/10/poor-tech-in-people-univ-of-china/#comment-429720433">过度嘲笑群众大学网站技术</a>，后来一位网管大人不知从链过来，纠正本小子的狂妄。六年前给高校统计论坛<a href="https://github.com/downloads/yihui/yihui.github.com/Thoughts-2006-Yihui-Xie.pdf">报告</a>，现在看来简直是屁都不懂，还瞎拽洋文，现在我还记得当时讲完去吃饭的时候一位（可能是北师的）师姐在电梯里问我局部多项式的事情，我胡乱搪塞了几句，仿佛很简单似的。五年前对自由度的解释忿忿不平，暴跳发日志一篇，有晕死的客官<a href="/cn/2007/10/degree-of-freedom/#comment-429720373">评论说</a>“深深感觉到博主有些牛气，有些自我膨胀，有些胡言乱语”，可惜当年那小子心高气傲根本没当回事。无聊的<a href="/cn/2007/10/my-life-as-a-paparazzo/">事情</a>和<a href="/cn/2007/10/rgui-translation/#comment-429720448">回复</a>也一大堆，没话找话狗尾续貂。</p>

<hr />

<p>用分秒的跨度来看，一切都没变化，无关痛痒。以五年十年为单位来看，因果事理的轮廓就开始凸显。去年年底看到《鹧鸪天》一首，转发给COS全站：</p>

<blockquote><p>记得窗前槐树吗？几回树下过家家。泥巴盘子泥巴碗，塑料摇车塑料娃。<br/>
儿时梦，散如沙，谁知转瞬即天涯。老房拆了树还在，一到夏天开白花。</p></blockquote>

<p>这就是时间的力量。我在<a href="/">首页</a>放了一首龚自珍的词，气场太强大了，当时狠狠震了我一把，千古声名，百年担负。</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>欲写已忘言</title>
      <link>http://yihui.name/cn/2012/02/many-things-to-nothing/</link>
      <pubDate>2012-02-20T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/02/many-things-to-nothing</guid>
      <content:encoded><![CDATA[<p>博客是不能断的东西，断久了就真不知道要写什么了，因为脑子已经超出键盘一大截，鸡零狗碎的装了一大堆。<a href="http://taiyun.cos.name">太云</a>的网站标题说优秀是一种习惯，这就是个习惯问题，要做好一件事情，不能指望大脑来控制（人脑从来都不靠谱），而是要把一件事情做成习惯。比如总是不写东西，慢慢地时间就被其它事情占据，久而久之，成了习惯，就再也写不动了。这周老板下山去了，于是更加放肆折腾自己的事情（代价是要上的课都留给我上了）。这次又得像<a href="/cn/2011/07/subtle-mind-to-great-waves/">上次</a>一样，各种残篇残念摘抄揉一起，所以难免意识流。</p>

<ol>
<li><p>雪</p>

<p> 今年村里天气有点奇特，用摔跤这个指标来衡量的话，我这个冬天只滑过一次。总体来说，尽管这地方雪大，但对冬天却没什么感觉，因为暖气太足，我总是想要是地球发生气候突变，美帝很可能先灭绝——环境太娇惯了。在英语环境中，雪似乎完全变成了一个纯粹的物理对象，什么感觉都没有。《九阴真经》中铁掌帮帮主上官南念了一首《三国》中的小诗（我是先看电视剧后知道出处的），让我印象深刻：</p>

<blockquote><p>一夜北风寒，万里彤云厚；<br/>
长空雪乱飘，改尽江山旧。<br/>
仰面观太虚，疑是玉龙斗；<br/>
纷纷麟甲飞，顷刻遍宇宙。<br/>
骑驴过小桥，独叹梅花瘦。</p></blockquote>

<p> 这里没法骑驴过小桥，只能开车过大桥，而且开车还得小心雪。前些日子有位大人在本小子的办公室白板上就这雪景题诗一首：</p>

<blockquote><p>流落美帝苦，漫天雪花舞。<br/>
闲来无事做，不如煮香菇。</p></blockquote>

<p> 按小说的规矩，一般在墙上题诗都是要造反的，不过这位是送香菇的，善哉善哉。一样是雪，有人鳞甲飞，有人煮香菇，各人有各人的逍遥自在。</p></li>
<li><p>巨子</p>

<p> 我放出<a href="/knitr/">knitr</a>之后，意外收到了很多巨子的回复，让我颇为惊喜。比如Venables，也就是<a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a>那位大人。收到V大人来信并不是最神奇的事情，而是他居然学过中文，过年那天他还用拼音跟我说新年快乐、恭喜发财。最近Harrell大人也在折腾knitr，已经下定决心用knitr重写他的书，跟这样的巨子交流就很爽快，因为他是明白人，受过Sweave的常年折磨，精确地知道怎样的软件才能让作者免于折磨，这样的人就是knitr最好的客户；很多人不像我受过几年Sweave折磨（最后才揭竿而起），所以无法理解knitr的优势所在；还有更可怕的情况是，有些人已经被Sweave的暗黑技巧深深毒害了思维方式，这样的人就更难说服了。还有一位<a href="http://www2.mdanderson.org/app/peoplefinder/person.cfm?id=3D5DD6DDC916">Coombes</a>大人，有些客官可能熟悉他，前两年Duke的癌症研究<a href="http://www.cbsnews.com/video/watch/?id=7398476n&amp;tag=cbsnewsMainColumnArea.8">丑闻</a>背后的“侦探”之一就是他，他一直宣扬可重复的研究，重头工具之一便是Sweave，本小子费了一番小牛鼻子劲，最后终于让他对knitr动心了。我本来做梦也没想到我会跟RStudio真的扯上关系，一年前我<a href="/cn/2011/03/rstudio/">写到RStudio</a>的时候只是觉得服务器版本很酷；结果后来Allaire大人亲自登门，一来二去，现在RStudio的<a href="http://www.rstudio.org/download/daily/desktop/">开发版本</a>中也纳入了knitr支持，而且俩人作个揖现在互为粉丝了，本小子又忍不住小得意了一番。顺便提一下，现在我的相互粉丝团成员三名，另外两名是咱COS的师姐与小轩哥。好了，尽管吹牛不交税，牛皮吹大了也不好收场，转入严肃话题。</p>

<p> 转台之前，为啥我用“巨子”这个词？显然我最近在看《秦时明月》，我觉得这动画挺好的，寒假在家跟着侄子一起看了几集，第二次觉得国产动画片挺有味道。第一次是看《魁拔》，可惜下一集不知道猴年马月才能出。</p>

<p> <img src="http://gb.cri.cn/mmsource/images/2011/06/08/60/5837897132219067376.jpg" alt="窝窝村，我喜欢这个名字" /></p></li>
<li><p>得失</p>

<p> 前天<a href="https://github.com/Jiangtang">江堂</a>来电，说<a href="http://github.com">GitHub</a>的事情。我又引一个人上了贼船，不，这不是贼船，是程序员的天堂。简单聊聊美帝生活，发现咱俩都是一山头看另一山头，相互羡慕。我看他生活有声有色，他看我心无旁骛专心折腾代码。文字这东西只是反映生活的一个视角，大部分时间里，可能我们生活也没啥大不一样。说到网站：</p>

<blockquote><p>J: 你的网站改版后看起来有品了啊<br/>
X: 其实内部一团糟啊<br/>
J: 人僧追求嘛啊！追求的奏是介个！<br/>
X: 嗯，也是，也是</p></blockquote>

<p> 我过去好像说过，我追求的就是一个字：美。美网站也好，美代码也好，美味佳肴也好（这个惭愧，追求下降了）。有时候想想，况且况且况况且登场，到底是要追求演一场小戏还是追求成王封侯？子曾经曰过：得之窃喜焉，失之未觉也。（不要搜出处，我是吕秀才的粉丝，大家懂的）</p>

<p> Youtube上有一则<a href="http://www.youtube.com/watch?feature=player_embedded&amp;v=C7DvYFRvDdw">无名视频</a>我觉得很好，它的特别之处在于前后5分钟的内容是一样的，但前5分钟有音乐，后5分钟完全静音。又是一个看事物角度的好例子，于无声处听——呃，不是惊雷——没词了。你听不听得见音乐，在于你心里有没有音乐。</p></li>
<li><p>下回分解</p>

<p> 搬家过后日志的长度明显不一样了，在线写日志和离线用记事本写日志是完全不同的感受。尽管现在倒了些废话出来，还有不少废话。下集预告：归去来兮。</p></li>
</ol>

]]></content:encoded>
    </item>
    
    <item>
      <title>Jekyll世界</title>
      <link>http://yihui.name/cn/2012/02/hello-jekyll/</link>
      <pubDate>2012-02-12T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2012/02/hello-jekyll</guid>
      <content:encoded><![CDATA[<p>一晃三个月过去，这里似乎没了动静。各位大人、路人以及丈人都很好奇，这娃儿究竟干啥去了，于是今天从山沟沟里爬出来解释一下。三个月前我说那是我在WordPress（WP）下写的最后一篇日志，话扔出来了当然不能反悔，尽管中途有几次想写点东西，但都憋回去了。不写日志也好，省点时间写代码。去年<a href="https://github.com/yihui/knitr/graphs/impact">10月份中旬</a>我鬼使神差开始写一个叫<a href="http://yihui.name/knitr/">knitr</a>的新包，其实也是我盘算了几年一直没干的一件事，最后对Sweave终于忍到了极点，操起键盘花了三个月革了命。这是题外话，以后再细说。</p>

<p>每个人离开一个软件或一套系统一般都带着负面情绪，比如烦恼抓狂恨，但WP必然不属于这一类系统；我看到的几乎每一个离开WP投奔<a href="http://github.com/mojombo/jekyll/">Jekyll</a>的人都无一例外大加赞扬WP，这事情就很有趣了，为什么你赞它还要弃用它？我虽然已经换到Jekyll，但也同样赞WP并感恩戴德，过去我已经说过好几次WP是程序设计的上乘之作，它的功能之灵活以及API之清晰别的网站系统很难比拟。然而某些码农的目标只是把事情做完（GTD），某些码农的追求则是无止境的，我就属于极简主义者，理想情况下我希望一套系统只有一个主要功能，把其它枝叶都砍掉，让用户能集中精神只做一件事情。比如博客网站只有写作功能，论坛只有讨论问题功能，聊天软件只有聊天功能。WP基本上符合这个要求了，它和其它的网站系统比，已经大大简化，只要模板设定好，剩下的就是写作；话虽这么说，实际情况却并非如此，我还是要花精力做一些额外的事情，比如我需要上网，要登录后台，要编辑HTML（像我这样的代码洁癖，眼里容不得冗余代码），要管理图片和附件，看着别人的新插件还眼馋（一装就又陷入新的维护陷阱），最要命的是，所有的东西都在数据库中，每次WP出了新版本，我都要颤颤巍巍点那个更新按钮，然后祈祷数据库不要出问题（我懒得导入导出备份）。</p>

<p>Jekyll完全推翻了传统网站的维护方式，它直接回到了“原点”——作者只需要维护文本文件，每一篇日志就是一个文件，程序会根据模板设置自动把这些文本文件翻译为网页。这些文本文件不用HTML，而是用简化版本的Markdown（MD）或者其它可最终翻译为HTML的伪标记语言。MD的哲学深得我心：把<a href="http://daringfireball.net/projects/markdown/">语法</a>简化90%，去实现大多数常用的HTML标签，牺牲少数不常用的标签（这些标签仍然可以用原始的HTML代码写）。比如要写无序列表的话，在HTML里面要用</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span>hello<span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span>world<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div>


<p>每一项列表项都用<code>li</code>标签围起来，而在MD语法里，只需要一行一行写就行了，每一行开头写一个减号 <code>-</code> 就足够，就像自己记笔记一样：</p>

<div class="highlight"><pre><code class="text">- hello
- world
</code></pre></div>


<p>一个字符（确切地说是两个，后面还得跟个空格）和一串要重复敲的字符比，哪个简洁显而易见。简洁的MD语法配合几项YAML设置就是一篇日志，扔进Liquid模版系统，Jekyll就把网站编译出来了。</p>

<p>八年前我在用文本文件做网站，八年后我又回到了文本文件，当然事情已经有了本质变化。这次从WP搬家，尽管有一些自动转换程序，但还是费了不少劲，423篇中文，103篇英文，几千评论，搬得我差点没疯掉。比如我做的第一件事情是解决<a href="/cn/2009/05/php-301-redirect-from-bo-blog-to-wordpress/">上一次搬家</a>的历史遗留问题：从Bo-blog搬到WP的时候，有些评论的嵌套关系乱了，所以我花了一天时间先把评论在数据库中修改对齐，这个过程基本上是手工看评论ID，把父评论和子评论的ID都记下来，然后用R生成几百条SQL语句，扔给数据库执行。评论整完导入Disqus，一个专注于做评论的网站。剩下的日志用一个Python程序从WP的XML文件导出为MD文件，导完又是一片残垣断壁，我只整理了最近的十篇日志，之前的几百篇用R正则表达式简单处理了一下，以后再慢慢手工整理，再往后还想把2004年起的一些老日志也导进来，像王晓伟说的，<a href="http://www.blog496.org/2011-2-11-stand-in-the-cross-road.html">记录生活</a>。英文<a href="/en/vitae/">简历页面</a>花了很大功夫整理了一下，主要是那些幻灯片文件，整体挪到GitHub中<a href="https://github.com/yihui/yihui.github.com/downloads">下载</a>，尽管这样会造成一批404错误，但文件太多，重定向太麻烦，想想算了。</p>

<p>凡事如果能退到文本文件的层面，基本上就意味着可以为所欲为了。就如同LaTeX是纯文本文件，所以很方便和R结合生成动态文档；PHP是纯文本文件，可以任意混合HTML代码。如果我乐意，我可以在MD代码里嵌入R代码，动态生成日志（这个实际上已经在knitr中实现了）。</p>

<p>使用Jekyll的另一大动力当然是GitHub，它提供编译服务，所以用户只需要用GIT管理文本文件就可以了。要写日志就新建一个文本文件，写完推上去完事，由于GIT支持离线工作，随时随地都可以写，不受网络环境限制。</p>

<p>为了找一个中意的模板，我把Jekyll维基上的网站列表扒了几遍，最后找到一个符合我理想中的样式的网站，<a href="http://lhzhang.com">作者</a>也是极简主义者。这个模板适合日志，但不太适合首页，所以我在<a href="/">首页</a>用了另一套模板。中文字体使用肖楠介绍过的<a href="http://www.road2stat.com/cn/tag/hiragino-sans-gb">冬青黑体</a>和微软雅黑，这样苹果和Windows都能看，而我相信Linux用户对中文字体总是有办法的，比如自己调一下文泉驿字体；英文优先使用Google字体中的Galdeano，然后使用其它常见无衬线字体。整个网页使用了一些HTML5标签，所以关于Windows下的IE浏览器我就不用多说了，若版本不够，页面可能会错乱。</p>

<p>日志页面中支持键盘左右方向键或JK键前后导航，这是JavaScript实现的，归功于<a href="http://ztpala.com/2012/01/16/jquery-keyboard-navigation/">Tao Zhang</a>。文章<a href="/cn/feed/">RSS订阅</a>依然存在，所有日志的链接也没有变化，只是评论RSS变了，要么订阅<a href="http://yihui.disqus.com/latest.rss">整站评论</a>，要么订阅单篇文章评论（每个页面的底部）。</p>

<p>一连看几年的文章的感触非常大，就像看一部快速播放的电影，生活在其中一天天过没什么感觉，但呼哧一下看过去，感觉很不一样，我从过去自己的一些评论和文章里总结了我的（至少）四点明显问题：</p>

<ul>
<li>明明年轻却卖老</li>
<li>气盛，欺人</li>
<li>很多评论非常无聊，为了评论而评论</li>
<li>中英混杂</li>
</ul>


<p>关于这些事，想想有点后背发凉，尤其是第二点，必然伤了一些人；而其中第四点我现如今逮一个批一个，不管是谁（包括师姐在内），不料自己过去其实也是这样的。</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>HTML5幻灯片</title>
      <link>http://yihui.name/cn/2011/11/html5-slides/</link>
      <pubDate>2011-11-03T00:00:00+08:00</pubDate>
      <author>谢益辉</author>
      <guid>http://yihui.name/cn/2011/11/html5-slides</guid>
      <content:encoded><![CDATA[<p>这大概是我在WordPress下写的最后一篇日志，我要奔向静态网站了。昨天<a href="http://www.stat.iastate.edu/seminars/seminar.html?id=649">在系里</a>做了个小报告，漫谈一下这几年开发R包的一些故事，基本上是鬼扯。这次的报告摘要是目前写得最成功的一个，因为一点都不严肃，通知发出去之后好几个人遇到我都号称“贼喜欢这摘要”，让我忍不住小得意了一番。由于早已厌倦学术报告上清一色的Beamer片子，我后来投奔古老的Foiltex（基本上就是白纸），这次<a href="http://yihui.github.com/slides/2011-r-dev-lessons.html">尝试了一下HTML5</a>，片子做出来我自己都觉得增加了不少讲的动力，因为风格完全自由了，愿意放图就放图，愿意用什么字体就用什么字体，简言之，要多华丽有多华丽。这片子有多难做呢？答案是会打字基本上就够了。我用的是keydown，Ruby Gem一枚，片子的<a href="https://raw.github.com/yihui/yihui.github.com/master/slides/2011-r-dev-lessons.md">源代码</a>极其简单。</p>

<p>珍爱生命，远离<code>\includegraphics{}</code>。</p>

<p>又及：珍爱生命，远离IE。</p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
